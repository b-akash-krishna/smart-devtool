/**
 * {{ api_name }} - TypeScript SDK
 * Generated by Smart DevTool
 * Version: {{ version }}
 */

export class {{ api_name | replace(" ", "") | replace("-", "") }}Client {
  private baseUrl: string;
  private timeout: number;
  {% if auth.type == "bearer" %}
  private token: string;
  {% elif auth.type == "api_key" %}
  private apiKey: string;
  {% endif %}

  constructor(options: {
    baseUrl?: string;
    {% if auth.type == "bearer" %}
    token?: string;
    {% elif auth.type == "api_key" %}
    apiKey?: string;
    {% endif %}
    timeout?: number;
  } = {}) {
    this.baseUrl = (options.baseUrl ?? "{{ base_url }}").replace(/\/$/, "");
    this.timeout = options.timeout ?? 30000;
    {% if auth.type == "bearer" %}
    this.token = options.token ?? "";
    {% elif auth.type == "api_key" %}
    this.apiKey = options.apiKey ?? "";
    {% endif %}
  }

  private getHeaders(): Record<string, string> {
    const headers: Record<string, string> = {
      "Content-Type": "application/json",
      Accept: "application/json",
    };
    {% if auth.type == "bearer" %}
    if (this.token) headers["Authorization"] = `Bearer ${this.token}`;
    {% elif auth.type == "api_key" %}
    if (this.apiKey) headers["{{ auth.header_name }}"] = this.apiKey;
    {% endif %}
    return headers;
  }

  {% for endpoint in endpoints %}
  /** {{ endpoint.summary }} */
  async {{ endpoint.method | lower }}{{ endpoint.path | replace("/", "_") | replace("{", "") | replace("}", "") | replace("-", "_") | trim("_") | title | replace("_", "") }}(
    {% for param in endpoint.parameters %}
    {{ param.name }}{% if not param.required %}?{% endif %}: {{ param.type | ts_type }},
    {% endfor %}
    {% if endpoint.method in ["POST", "PUT", "PATCH"] %}
    body?: Record<string, unknown>,
    {% endif %}
  ): Promise<unknown> {
    const url = new URL(`${this.baseUrl}{{ endpoint.path }}`);
    {% for param in endpoint.parameters %}
    {% if param.location == "query" %}
    if ({{ param.name }} !== undefined) url.searchParams.set("{{ param.name }}", String({{ param.name }}));
    {% endif %}
    {% endfor %}

    const response = await fetch(url.toString(), {
      method: "{{ endpoint.method }}",
      headers: this.getHeaders(),
      {% if endpoint.method in ["POST", "PUT", "PATCH"] %}
      body: body ? JSON.stringify(body) : undefined,
      {% endif %}
    });

    if (!response.ok) throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    return response.json();
  }

  {% endfor %}
}